{% extends "base.html" %}

{% block content %}
<style>
    .dashboard-container {
        background: #f8fafc;
        min-height: calc(100vh - 100px);
        margin: -1rem -0.75rem;
        padding: 1rem;
    }

    .welcome-card {
        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        border-radius: 16px;
        padding: 1.25rem 1.5rem;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .welcome-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .welcome-card h2 {
        font-weight: 700;
        margin-bottom: 0.25rem;
        font-size: 1.5rem;
    }

    .welcome-card p {
        opacity: 0.9;
        margin-bottom: 0;
        font-size: 0.9rem;
    }

    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 0.875rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
    }

    .stat-icon.blue {
        background: linear-gradient(135deg, #3b82f6, #60a5fa);
        color: white;
    }

    .stat-icon.green {
        background: linear-gradient(135deg, #22c55e, #4ade80);
        color: white;
    }

    .stat-icon.purple {
        background: linear-gradient(135deg, #8b5cf6, #a78bfa);
        color: white;
    }

    .stat-icon.amber {
        background: linear-gradient(135deg, #f59e0b, #fbbf24);
        color: white;
    }

    .stat-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1e293b;
    }

    .stat-label {
        font-size: 0.75rem;
        color: #64748b;
    }

    .section-card {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        height: 100%;
    }

    .section-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-title i {
        color: #3b82f6;
        font-size: 0.9rem;
    }

    .appointment-item {
        display: flex;
        align-items: center;
        padding: 0.6rem;
        background: #f8fafc;
        border-radius: 8px;
        margin-bottom: 0.5rem;
    }

    .appointment-item:last-child {
        margin-bottom: 0;
    }

    .appt-avatar {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.85rem;
        margin-right: 0.75rem;
    }

    .appt-info {
        flex: 1;
    }

    .appt-doctor {
        font-weight: 600;
        color: #1e293b;
        font-size: 0.85rem;
    }

    .appt-specialty {
        font-size: 0.75rem;
        color: #64748b;
    }

    .appt-time {
        text-align: right;
        font-size: 0.75rem;
    }

    .appt-date {
        color: #1e293b;
        font-weight: 500;
    }

    .appt-hour {
        color: #64748b;
    }

    .reminder-item {
        display: flex;
        align-items: center;
        padding: 0.6rem;
        background: linear-gradient(135deg, #fef3c7, #fef9c3);
        border-left: 3px solid #f59e0b;
        border-radius: 6px;
        margin-bottom: 0.5rem;
    }

    .reminder-item:last-child {
        margin-bottom: 0;
    }

    .reminder-icon {
        width: 32px;
        height: 32px;
        background: #f59e0b;
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.75rem;
        font-size: 0.85rem;
    }

    .reminder-info {
        flex: 1;
    }

    .reminder-medicine {
        font-weight: 600;
        color: #92400e;
        font-size: 0.85rem;
    }

    .reminder-dosage {
        font-size: 0.75rem;
        color: #a16207;
    }

    .reminder-badge {
        background: #ef4444;
        color: white;
        padding: 0.15rem 0.5rem;
        border-radius: 12px;
        font-size: 0.65rem;
        font-weight: 600;
    }

    .quick-action {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 0.5rem;
        background: #f8fafc;
        border-radius: 8px;
        text-decoration: none;
        color: #1e293b;
        transition: all 0.2s;
        text-align: center;
    }

    .quick-action:hover {
        background: #3b82f6;
        color: white;
    }

    .quick-action:hover i {
        color: white;
    }

    .quick-action i {
        font-size: 1.1rem;
        color: #3b82f6;
        margin-bottom: 0.25rem;
    }

    .quick-action span {
        font-weight: 500;
        font-size: 0.75rem;
    }

    .health-stat {
        text-align: center;
        padding: 0.5rem;
    }

    .health-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1e293b;
    }

    .health-label {
        font-size: 0.7rem;
        color: #64748b;
        text-transform: uppercase;
    }

    .health-unit {
        font-size: 0.75rem;
        color: #94a3b8;
    }

    .empty-state {
        text-align: center;
        padding: 1rem;
        color: #94a3b8;
    }

    .empty-state i {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        opacity: 0.4;
    }

    .empty-state p {
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
    }
</style>

<div class="dashboard-container">
    <!-- WELCOME CARD -->
    <div class="welcome-card mb-3">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2>Good {{ 'Morning' if now().hour < 12 else ('Afternoon' if now().hour < 17 else 'Evening' ) }}, {{
                        profile.name }}! ðŸ‘‹</h2>
                        <p>
                            {% if next_appointment %}
                            Next: <strong>Dr. {{ next_appointment.doctor.name }}</strong> on {{
                            next_appointment.slot.start_time.strftime('%d %b, %I:%M %p') }}
                            {% else %}
                            No upcoming appointments. Stay healthy!
                            {% endif %}
                        </p>
            </div>
            <div class="col-md-4 text-end">
                <a href="{{ url_for('patient.find_doctor') }}" class="btn btn-light px-3">
                    <i class="fas fa-search me-1"></i>Find Doctor
                </a>
            </div>
        </div>
    </div>

    <!-- STAT CARDS -->
    <div class="row g-2 mb-3">
        <div class="col-6 col-lg-3">
            <div class="stat-card">
                <div class="stat-icon blue"><i class="fas fa-calendar-check"></i></div>
                <div>
                    <div class="stat-value">{{ upcoming_count }}</div>
                    <div class="stat-label">Upcoming</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3">
            <div class="stat-card">
                <div class="stat-icon green"><i class="fas fa-stethoscope"></i></div>
                <div>
                    <div class="stat-value">{{ completed_visits }}</div>
                    <div class="stat-label">Visits</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3">
            <div class="stat-card">
                <div class="stat-icon purple"><i class="fas fa-pills"></i></div>
                <div>
                    <div class="stat-value">{{ active_prescriptions }}</div>
                    <div class="stat-label">Prescriptions</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3">
            <div class="stat-card">
                <div class="stat-icon amber"><i class="fas fa-box"></i></div>
                <div>
                    <div class="stat-value">{{ total_orders }}</div>
                    <div class="stat-label">Orders</div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-3">
        <!-- LEFT COLUMN -->
        <div class="col-lg-8">
            <div class="row g-3">
                <!-- UPCOMING APPOINTMENTS -->
                <div class="col-md-6">
                    <div class="section-card">
                        <div class="section-title">
                            <i class="fas fa-calendar-alt"></i> Upcoming
                            <a href="{{ url_for('patient.my_appointments') }}"
                                class="ms-auto btn btn-sm btn-outline-primary py-0 px-2" style="font-size: 0.7rem;">View
                                All</a>
                        </div>
                        {% if upcoming_appointments %}
                        {% for appt in upcoming_appointments[:3] %}
                        <div class="appointment-item">
                            <div class="appt-avatar">{{ appt.doctor.name[0] if appt.doctor else 'D' }}</div>
                            <div class="appt-info">
                                <div class="appt-doctor">Dr. {{ appt.doctor.name }}</div>
                                <div class="appt-specialty">{{ appt.doctor.specialty or 'General' }}</div>
                            </div>
                            <div class="appt-time">
                                <div class="appt-date">{{ appt.slot.start_time.strftime('%d %b') }}</div>
                                <div class="appt-hour">{{ appt.slot.start_time.strftime('%I:%M %p') }}</div>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-calendar-plus d-block"></i>
                            <p>No upcoming appointments</p>
                            <a href="{{ url_for('patient.find_doctor') }}" class="btn btn-primary btn-sm py-1 px-3"
                                style="font-size: 0.75rem;">Book Now</a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- MEDICINE REMINDERS -->
                <div class="col-md-6">
                    <div class="section-card">
                        <div class="section-title">
                            <i class="fas fa-bell"></i> Medicine Reminders
                        </div>
                        {% if reminders %}
                        {% for rem in reminders[:3] %}
                        <div class="reminder-item">
                            <div class="reminder-icon"><i class="fas fa-pills"></i></div>
                            <div class="reminder-info">
                                <div class="reminder-medicine">{{ rem.medicine }}</div>
                                <div class="reminder-dosage">{{ rem.dosage }}</div>
                            </div>
                            <span class="reminder-badge">Take Now</span>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-check-circle d-block" style="color: #22c55e;"></i>
                            <p class="mb-0">No medicines to take right now</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="col-lg-4">
            <!-- QUICK ACTIONS -->
            <div class="section-card mb-3">
                <div class="section-title">
                    <i class="fas fa-bolt"></i> Quick Actions
                </div>
                <div class="row g-2">
                    <div class="col-4">
                        <a href="{{ url_for('patient.find_doctor') }}" class="quick-action">
                            <i class="fas fa-user-md"></i>
                            <span>Doctors</span>
                        </a>
                    </div>
                    <div class="col-4">
                        <a href="{{ url_for('patient.my_appointments') }}" class="quick-action">
                            <i class="fas fa-calendar"></i>
                            <span>Appts</span>
                        </a>
                    </div>
                    <div class="col-4">
                        <a href="{{ url_for('patient.my_prescriptions') }}" class="quick-action">
                            <i class="fas fa-prescription"></i>
                            <span>Rx</span>
                        </a>
                    </div>
                    <div class="col-4">
                        <a href="{{ url_for('patient.history') }}" class="quick-action">
                            <i class="fas fa-file-medical"></i>
                            <span>Records</span>
                        </a>
                    </div>
                    <div class="col-4">
                        <a href="{{ url_for('patient.my_orders') }}" class="quick-action">
                            <i class="fas fa-truck"></i>
                            <span>Orders</span>
                        </a>
                    </div>
                    <div class="col-4">
                        <a href="{{ url_for('patient.profile') }}" class="quick-action">
                            <i class="fas fa-user-circle"></i>
                            <span>Profile</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- HEALTH PROFILE -->
            <div class="section-card">
                <div class="section-title">
                    <i class="fas fa-heartbeat"></i> Health Profile
                </div>
                {% if profile.height_cm or profile.weight_kg or profile.blood_group %}
                <div class="row">
                    {% if profile.height_cm %}
                    <div class="col-4">
                        <div class="health-stat">
                            <div class="health-value">{{ profile.height_cm|int }}</div>
                            <div class="health-unit">cm</div>
                            <div class="health-label">Height</div>
                        </div>
                    </div>
                    {% endif %}
                    {% if profile.weight_kg %}
                    <div class="col-4">
                        <div class="health-stat">
                            <div class="health-value">{{ profile.weight_kg|int }}</div>
                            <div class="health-unit">kg</div>
                            <div class="health-label">Weight</div>
                        </div>
                    </div>
                    {% endif %}
                    {% if profile.blood_group %}
                    <div class="col-4">
                        <div class="health-stat">
                            <div class="health-value" style="color: #ef4444;">{{ profile.blood_group }}</div>
                            <div class="health-unit">&nbsp;</div>
                            <div class="health-label">Blood</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p class="mb-1">Complete your profile</p>
                    <a href="{{ url_for('patient.edit_profile') }}" class="btn btn-sm btn-outline-primary py-0 px-2"
                        style="font-size: 0.7rem;">Update</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}